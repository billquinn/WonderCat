---
output:
  reprex::reprex_document:
    venue: "gh"
    advertise: FALSE
    session_info: TRUE
    style: TRUE
    comment: "#;-)"
    tidyverse_quiet: FALSE
    std_out_err: TRUE
knit: reprex::reprex_render
---

# WonderCat

```{r}
library(tidyverse)
library(shiny)
library(httr2)
library(jsonlite)
library(dplyr)
library(bslib)
library(DT)
library(ggplot2)
library(ggraph)
library(igraph)
library(plotly)

print (getwd())
# Import functions.
source(paste0(getwd(), 'Documents/DH/GitHub/WonderCat/WonderCat', '/functions.R'))
```

## API Call

NEED TO PULL DATA FROM EACH PAGE; CURRENTLY PULLING FROM ONLY FIRST PAGE!!!!
```{r}

WP_USER <- 'bill.quinn@marist.edu'
WP_KEY <- 'f45D rE4U BoIR w6xq Yle7 ktEE'
API_prefix <- "https://env-1120817.us.reclaim.cloud/wp-json/wp/v2/user-experience"

req <- request(API_prefix)

resp <- req |> req_perform() |> resp_body_json(check_type = TRUE, simplifyVector = TRUE)
```

## Create DataFrame
```{r}
# Clean Up Dataframe
clean_up_dataframe <- function(data){
  dataframe <- data %>% 
    select(id, author, date, benefit, experience, technology, acf) %>% 
    unnest(c(benefit, experience, technology, acf), names_sep = '.') %>%
    select(
      id, author, date, 
      benefit.name, experience.name, technology.name, 
      acf.title_of_creative_work, starts_with('acf.wikidata-qid')
      )
  
  colnames(dataframe) <- c(
    'id', 'author', 'date', 'benefit', 'experience', 'technology', 'title', 'QID'
  )
  
  return (dataframe)
}

dataframe <- clean_up_dataframe(resp)
```

### Bar Plot
```{r}
bar_data <- dataframe %>% count(benefit)

p <- bar_data |>
      ggplot(aes(x = n, y = benefit, fill = benefit)) +
      geom_bar(stat = "identity")

ggplotly(p)
```

